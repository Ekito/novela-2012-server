@(userId:String)


@css = {
}

@javascript = {

	<script src="http://openlayers.org/api/OpenLayers.js" type="text/javascript"></script>
	
	<script src="@routes.Assets.at("javascripts/constant.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/sketchy.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/sketchytrack.js")" type="text/javascript"></script>

	<script src="@routes.Assets.at("javascripts/map.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/kaazing/StompJms.js")" type="text/javascript"></script>
	<script src="@routes.Assets.at("javascripts/kaazing/kaazing.js")" type="text/javascript"></script>
	
	<script type="text/javascript">
	$(document).ready(function() {
			$.map.init();

		    var firstPoint = true;
			
			function onMessage(message) {
		    	
		    	var location = JSON.parse(message.getText());

		    	var me = (location.user.id == @userId);
		    	
		      	$.map.addPointToTrack(
		      			location.user.id,	// FIXME should be the track id instead
		      			{
		      				"lat":location.lat,
		      				"lon":location.lon
		      			},
		      			{
		      					redraw: true,	// redraw the layer
		      					center: false,	// call showAllTracks
		      					isMe: me
		      			});

		      	if (firstPoint) {
		      		$.map.showAllTracks();
		      		firstPoint = false;
		      	}
		    }
		
			setupKaazing("ws://ec2-46-137-8-173.eu-west-1.compute.amazonaws.com:8001/jms", onMessage);
			
			$("#startSimulation").click(function() {
				
				// TODO NDE : use a JS route
				$.ajax(
				{
                    url: "/simulation/start/",
                    method: 'get',
                    success : function(data) {
                    	console.log("Simulation started")
                    }
                    
                })
			})
			
		}
	);
	</script>
}


@main(Messages("title"))("map")(javascript)(css) {

	<div  id="map" data-bg="@routes.Assets.at("images/white.png")">
<!-- 
		<a href="#" onclick="$.map.showAllTracks();">center map</a>
		<a href="#" onclick="$.map.addTrack(1,stubs[1],{redraw:true,center:true});">add track</a>
		<a href="#" onclick="$.map.addPointsToTrack(0,stubs[3],{redraw:true,center:true});">add points to track</a> -->
		<a id="startSimulation" class="btn">Click here to start a simulation</a>
	</div>
	
}